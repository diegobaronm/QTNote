This section describes the analysis methodology. We use boosted $Z\to\tauhad\taulep$ events to measure Monte Carlo correction factors for the tau identification algorithms in the high-$\pt$ region.

Different working points are defined for RNN score relative to the efficiency of selecting true $\tauhad$ candidates. When the efficiency of the working points is measured in data and simulation, a correction factor has to be derived and then applied to the simulation in order for the signal efficiency to agree between data and simulation \cite{ATLAS:2017mpa}. Because of the top quark mass, $t\bar{t}$ events are usually used as a source of high momentum taus for measuring correction factors on the high-$p_T$ bins. However, Lepton universality may not hold in W decays. For that reason our study is aimed to use boosted $Z\to\tauhad\taulep$ events for deriving and cross checking the simulation correction factors in the high-$p_T$ region.   
\subsection{Signal events}\label{signalevents}
For this study, we consider as signal events where one the taus decays hadronically and the other leptonically, either into an electron or a muon. Thus, our final states will include a $\tauhad$ candidate and a lepton $l=e,\mu$. The presence of the light lepton will be used as our tag. 
Generally, in $\Zll$ events, the taus are produced back to back and their $\pt$ spectrum falls sharply. In order to select boosted taus in the transverse plane we look for events where the opening angle in the transverse plane between the taus ($\Delta\phi(\tauhad,\taulep)$) is acute. A depiction of the topologies of our signal events is shown in Fig.\ref{Fig1}. For these events, the missing transverse momentum ($\met$) is assumed to come from the neutrinos produced in the decays of the tau leptons. Due to the fact that two neutrinos are produced in the leptonic decay mode we expect our events to have a larger $\met$ component along the $\taulep$ direction.
\begin{figure}[htbp]
	\centering
	\subfloat[]{\label{Fig1a}{\includegraphics[width=0.49\textwidth]{Fig1a}}}\hfill
	\subfloat[]{\label{Fig1b}{\includegraphics[width=0.49\textwidth]{Fig1b}}}
	\caption{The two different types of topologies that define the signal events. On the left, when the missing energy is between the visible objects two neutrinos are assumed to be responsible for all the missing energy. On the right, only one neutrino is assumed to be flying on the direction of the visible object closest to the missing energy.}
	\label{Fig1}
\end{figure}
We classify our events in two types of topologies. First, events where the $\met$ is inside the opening angle between the visible objects. For this kind of events, we assume that the missing energy is due to a pair of neutrinos flying in the same direction as the visible objects. This is shown in Fig.\ref{Fig1a}. In this case, we solve the following equation to obtain the momentum of the neutrinos:
\begin{equation}
\vec{p}_{T_{\nu_l}}+\vec{p}_{\nu_h}=\vec{\met},
\end{equation}
given the following set of constraints (\textit{collinear approximation}):
\begin{align}
	\phi(\nu_l)&=\phi(l),
	\\
	\phi(\nu_h)&=\phi(\tauhad),
	\\
	\eta(\nu_l)&=\eta(l),
	\\
	\eta(\nu_h)&=\eta(\tauhad).
\end{align}
The second case, is when the $\met$ is pointing outside the angle formed by the visible objects, as is shown in Fig.\ref{Fig1b}. In this case, the assumption is that only one neutrino is responsible for the majority of the $\met$. We suppose it is flying in the direction of the visible object that is closest to the $\met$. We use the following equations to obtain the neutrino momentum:
\begin{align}
	p_{T_{\nu}}&=\met \cos(\Delta\phi(\tau_{\text{closer}},\met)),
	\\
	\phi(\nu)&=\phi(\tau_{\text{closer}}),
	\\
	\eta(\nu)&=\eta(\tau_{\text{closer}}),
\end{align} 
where $\tau_{closer}$ stands for the visible object closest to the direction of the $\met$.

We define a variable called $\Omega$ in order to classify our events in the already described topologies . First, we define:
\begin{equation}
\omega=\frac{\Delta\phi(\tau_{\text{closer}},\met)}{\Delta\phi(\tauhad,\taulep)},
\end{equation}
then,
\begin{itemize}
	\item when $\met$ is inside the opening angle between the visible objects but closer to $\tauhad$:
	\begin{equation}
	\Omega=\omega,
	\end{equation}
	\item when $\met$ is still inside, but closer to $\taulep$:
	\begin{equation}
	\Omega=1-\omega.
	\end{equation}
	\item If $\met$ is outside and closer to $\tauhad$:
	\begin{equation}
	\Omega=-\omega,
	\end{equation}
	\item and finally, if $\met$ is outside and closer to $\taulep$:
	\begin{equation}
	\Omega=\omega+1.
	\end{equation}
\end{itemize}
Thus, $\Omega$ is a continuous variable that give us information on the topology of the event. When $\met$ is inside the visible system it has values in the interval [0,1]. It is exactly 0 when $\met$ is in the $\tauhad$ direction and 1 when $\met$ is in the $\taulep$ direction. $\Omega$ has negative values when $\met$ is outside and closer to the $\tauhad$ candidate and has positive and values greater than 1 when is outside and closer to the $\taulep$. A diagram describing the $\Omega$ values is shown in Fig.\ref{Fig2}.
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.5\textwidth]{Fig2.png}
	\caption{Graphical representation of the different values of $\Omega$ depending on the region where the $\met$ is located in the event.}
	\label{Fig2}
\end{figure}
As we will see later, the event classification into these different types of topologies will allow us to reconstruct and exploit kinematical variables as the invariant mass of the di-tau system, the Z boson transverse momentum ($Z\pt$) and the angular distribution of the objects in the event.

\subsection{Scale Factors Calculation}
Conventionally, the correction or scale factors (SFs), are defined as the ratio of the efficiency in data and simulation of a $\tauhad$ candidate to pass a certain level of identification. This method makes the measurement sensitive not only to the uncertainties coming from the tau reconstruction but to the light lepton trigger, reconstruction and identification. Additionally, $\POWPY$ and $\SHERPA$ simulations give different predictions for the $Z\pt$. Consequently, differences in the kinematics of the reconstructed objects also affect the measurement.

Therefore, an alternative approach has been taken. First, the ratio of observed signal events to predicted events in simulation for $Z\to\tauhad\taulep$ is defined as:
\begin{equation}
	C_{X}(Z\to\tauhad\taulep)=\frac{\NData}{\NMC}.
\end{equation}
Where X is any of the tau-ID working points, $\NData$ is the number of $Z\to\tauhad\taulep$ events observed in the data having subtracted the background predictions and $\NMC$ are the number of simulated $\Ztt$ events with one truth-matched $\tauhad$. Next, we calculate the same ratio but for $Z\to ll$ events:
\begin{equation}
C(Z\to ll)=\frac{\NData}{\NMC}.
\end{equation}
Here, $\NData$ is the number of $Z\to ll$ events observed in data having subtracted the background predictions and $\NMC$ is the number of simulated $\Zll$ events passing all the selections.

Finally, to define the SFs we take the following double ratio:
\begin{equation}
SF_{X}=\frac{C_{X}(Z\to\tauhad\taulep)}{C(Z\to ll)}.
\end{equation}
With this method we expect, at least at first order, to cancel the light lepton related uncertainties. Additionally, phenomenological uncertainties as the $Z\pt$ modelling would be reduced as well.
\subsection{Event Selection}\label{sec3.3}
In order to select $Z\to\tauhad\taulep$ events, our basic selection includes events with exactly one $\tauhad$ candidate and one light lepton. A muon or an electron. The $\tauhad$ and lepton pair need to have opposite charge. As we said, the presence of the lepton will be used as our tag, thus, a lepton trigger is required to be fired with an online requirement on the $p_{T}(\mu)\geq 20$ ($p_{T}(e)\geq 24$) GeV for 2015 data taking period. For 2016-2018 the online requirement is $p_{T}(\mu,e)\geq 26$ GeV. The muons are required to pass a \textit{medium} ID requirement and the electron has to pass a \textit{tight} ID filter. Additionally, both muons and electrons have to pass an offline $p_T$ requirement, it has to be greater than 27 GeV. Finally, the opening angle between the two visible objects $\Delta\phi(\tauhad,l)\leq 2\pi/3$.

Events containing b-jets are vetoed in order to reject $t\bar{t}$ events. In addition, an isolation criterion is required to be passed by the leptons: for the muon (electron), the scalar sum of the $p_T$ of the tracks within a cone of $\Delta R=0.3 (0.2)$ of the muon (electron) must be less than 0.06 times the muon (electron) $p_T$. Additionally, for the electron, the sum of the calorimeter cluster energy in a cone of size $\Delta R=0.2$ must be 0.06 times smaller than the electron $p_T$. As we said, we expect signal events to peak around $\Omega=1$, thus we select events where $\Omega\in (0,1.4)$. Fig.\ref{Fig3} shows the $\Omega$ distribution for $Z\to\tauhad\mu$ final state.
\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.6\textwidth]{figures/Fig3.png}
	\caption{Distribution of $\Omega$ for $Z\to\tauhad\mu$ final state. All the other cuts have been applied apart from the one being plotted. The ATLAS data is shown as points with error bars, showing the statistical uncertainties. The detector-level predictions are shown as the shaded histograms, with the colour code as given on the plots.The region between the vertical dashed red lines is included in the final candidate event sample. The lower section of each plot shows the ratio of data to prediction. The uncertainties on the predictions represent the MC statistical uncertainties. These uncertainties are shown as blue shaded regions.}
	\label{Fig3}
\end{figure}
Additionally, a cut on the reconstructed invariant mass ($\mreco$) of the event is made. The cut aims to pick events where the invariant mass is around the Z boson mass ($70\leq\mreco\leq 110$ GeV). The invariant mass of the final states is calculated depending on the event topology. For events where $\Omega\in [0,1]$ (\textit{in-between events}),
\begin{equation}
\mreco^{2}=(q_l+q_{\tauhad}+q_{\nu_l}+q_{\nu_{\tauhad}})^2.
\label{eq35}
\end{equation}
When the $\met$ is outside (\textit{outside events}),
\begin{equation}
(\mreco-5)^{2}=(q_l+q_{\tauhad}+q_\nu)^2.
\label{eq36}
\end{equation}
The RHS of \eqref{eq35} and \eqref{eq36} are vector sums, where $q$ represents the four-momentum of each particle. In the outside events case we manually add 5 GeV to maintain our cuts consistent, since in this region we find empirically that the di-tau mass is underestimated and we wish to apply the same selection in both regions. Fig.\ref{Fig4} shows the distribution of $\mreco$ for the in-between and outside $Z\to\tauhad\mu$ events. 
\begin{figure}[htbp]
	\centering
	\subfloat[]{\label{Fig4a}{\includegraphics[width=0.50\textwidth]{figures/Fig4a}}}\hfill
	\subfloat[]{\label{Fig4b}{\includegraphics[width=0.50\textwidth]{figures/Fig4b}}}
	\caption{$\mreco$ distribution for the in-between region (a) and the outside region (b). All the other cuts have been applied apart from the one being plotted.}
	\label{Fig4}
\end{figure}

In addition, for the $Z\to\tauhad e$ final state, we add two cuts aimed to reject events where the $\tauhad$ candidate is faked by an electron. First, a requirement on the invariant mass of the electron and $\tauhad$ candidate is made, $m(e,\tauhad)<80$ GeV. Then, we also make use of an ID algorithm trained to discriminate electrons from real $\tauhad$. We require, eBDTScore$\geq 0.06$. The distributions for these variables are shown in Fig.\ref{Fig5}.
\begin{figure}[htbp]
	\centering
	\subfloat[]{\label{Fig5a}{\includegraphics[width=0.50\textwidth]{figures/Fig5a}}}\hfill
	\subfloat[]{\label{Fig5b}{\includegraphics[width=0.50\textwidth]{figures/Fig5b}}}
	\caption{Distribution of the variables used for rejecting $\tauhad$ fakes coming from electrons. On the right $m(e,\tauhad)$ distribution (a) and on the left the eBDTScore distribution (b). All the other cuts have been applied apart from the one being plotted.}
	\label{Fig5}
\end{figure}

Finally, in order to measure the tau ID scale factors on the high-$p_T$ region we select events where $p_T(\tauhad)\geq 45$ GeV. The $p_T$ distributions for $\tauhad$ candidates are shown in Fig.\ref{Fig6} for the in-between and outside regions.
\begin{figure}[htbp]
	\centering
	\subfloat[]{\label{Fig6a}{\includegraphics[width=0.50\textwidth]{figures/Fig6a}}}\hfill
	\subfloat[]{\label{Fig6b}{\includegraphics[width=0.50\textwidth]{figures/Fig6b}}}
	\caption{$p_T(\tauhad)$ distribution for the in-between (a) and outside (b) regions. All the other cuts have been applied apart from the one being plotted.}
	\label{Fig6}
\end{figure} 
